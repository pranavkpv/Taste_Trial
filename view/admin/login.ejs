<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Taste Trial - Admin</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-light d-flex align-items-center min-vh-100">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-12 col-md-6 col-lg-4">
				<div class="card shadow rounded-4 p-4">
					<div class="text-center mb-4">
						<i class="fa fa-user-o fs-1 text-primary"></i>
					</div>
					<form class="login-form  rounded-4 shadow-sm bg-white"
						onsubmit="return loginSuccess(event)" novalidate style="max-width: 400px; margin: auto;">
						<h1 class="mb-4 text-center fw-bold">Admin Login</h1>

						<input type="text" name="email" autocomplete="username" hidden />
						<input type="password" name="password" autocomplete="current-password" hidden />

						<div class="mb-3">
							<label for="username" class="form-label visually-hidden">Username</label>
							<input type="text" class="form-control rounded-pill" placeholder="Username" name="username"
								id="username" />
							<div id="username-error" class="form-text text-danger"></div>
						</div>

						<div class="mb-3 position-relative">
							<label for="password" class="form-label visually-hidden">Password</label>
							<input type="password" class="form-control rounded-pill pe-5" placeholder="Password"
								name="password" id="password" />
							<button type="button"
								class="btn position-absolute top-50 end-0 translate-middle-y me-3 p-0 border-0 bg-transparent"
								id="togglePassword" tabindex="-1" aria-label="Toggle password visibility" style="height: 2rem;">
								<i class="fa fa-eye-slash text-secondary fs-5"></i>
							</button>
							<div id="password-error" class="form-text text-danger"></div>
						</div>

						<div class="d-grid mt-4">
							<button type="submit" class="btn btn-primary rounded-pill py-3 fw-bold">Get Started</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<script>
		async function loginSuccess(event) {
			event.preventDefault();
			const username = document.getElementById('username').value.trim();
			const password = document.getElementById('password').value.trim();
			document.getElementById('username-error').innerText = '';
			document.getElementById('password-error').innerText = '';

			try {
				const response = await fetch('/admin/login', {
					method: 'POST',
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ username, password })
				});

				const data = await response.json();


				if (!data.success) {
					const errorMessages = data.message.split(',');
					if (errorMessages.includes("Username Is Required")) {
						document.getElementById('username-error').innerText = "Username is required.";
					}
					if (errorMessages.includes("Password Is Required")) {
						document.getElementById('password-error').innerText = "Password is required.";
					}
					if (errorMessages.includes("Username Is Wrong")) {
						document.getElementById('username-error').innerText = "Username is incorrect.";
					}
					if (errorMessages.includes("Password Is Wrong")) {
						document.getElementById('password-error').innerText = "Password is incorrect.";
					}
					return
				} else {
					Swal.fire({
						title: data.message,
						icon: "success",
						draggable: true,
						confirmButtonText: "OK"
					}).then((result) => {
						if (result.isConfirmed) {
							window.location.href = "/admin/dashboard";
						}
					});
				}
			} catch (error) {
				console.error("Error:", error);
				alert("There was an error processing your request. Please try again.");
			}
		}

		document.getElementById("togglePassword").addEventListener("click", function () {
			const passwordInput = document.getElementById("password");
			const icon = this.querySelector("i");
			if (passwordInput.type === "password") {
				passwordInput.type = "text";
				icon.classList.remove("fa-eye-slash");
				icon.classList.add("fa-eye");
			} else {
				passwordInput.type = "password";
				icon.classList.remove("fa-eye");
				icon.classList.add("fa-eye-slash");
			}
		});
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>