<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('partials/userheader') %>

<!-- Hero Carousel Section -->
<section class="hero-carousel">
  <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">

      <% if (banners && banners.length > 0) { %>
      <% banners.forEach((banner, index) => { %>
      <div class="carousel-item position-relative <%= index === 0 ? 'active' : '' %>">
        <img src="<%= banner.image %>" class="d-block w-100" alt="<%= banner.title %>">

        <!-- Gradient overlay -->
        <div class="position-absolute top-0 start-0 w-100 h-100"
          style="background: linear-gradient(90deg, rgba(0,0,0,0.7) 30%, rgba(0,0,0,0.3) 80%); z-index:1;"></div>

        <div
          class="carousel-caption d-flex flex-column justify-content-center align-items-start text-start p-4 p-md-5"
          style="top: 50%; transform: translateY(-50%); max-width: 50%; z-index: 2;">
          <h1 class="display-3 fw-bold text-white shadow-sm"><%= banner.title %></h1>
          <form action="/user/category" class="mt-4">
            <button type="submit"
              class="btn btn-warning btn-lg px-5 rounded-pill d-flex align-items-center gap-2 shadow">
              Purchase Now <i class="fas fa-arrow-right"></i>
            </button>
          </form>
        </div>
      </div>
      <% }) } %>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
      <span class="carousel-control-prev-icon shadow-lg rounded-circle bg-dark bg-opacity-50 p-2" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
      <span class="carousel-control-next-icon shadow-lg rounded-circle bg-dark bg-opacity-50 p-2" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</section>

<!-- Categories Section -->
<section class="categories-section py-3">
  <div class="container-fluid">
    <div class="text-center mb-5">
      <h2 class="fw-bold text-dark">Explore Our Categories</h2>
      <p class="text-secondary fs-5">Discover our curated collection of delicious options</p>
    </div>

    <div class="row g-4">
      <% categories.forEach((element, idx) => { %>
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex">
        <form action="/user/product" method="get" class="card shadow-sm border-0 w-100 overflow-hidden d-flex flex-column">
          <input type="hidden" name="categoryId" value="<%= element._id %>">
          <button type="submit" class="btn p-0 w-100 text-start text-decoration-none d-flex flex-column">
            <div class="position-relative overflow-hidden flex-shrink-0" style="height: 220px;width:100%">
              <img src="<%= element.image %>" alt="<%= element.categoryname %>" 
                class="card-img-top h-100 object-fit-cover" style="width:100%">
              <!-- Animated colored decal on corner -->
              <div class="position-absolute top-0 start-0 rounded-bottom-end"
                style="width: 4px; height: 50px; background: linear-gradient(45deg, #FF6B6B, #FFD93D);"></div>
              <div
                class="position-absolute top-50 start-50 translate-middle d-flex justify-content-center align-items-center opacity-0 hover-opacity-100 transition-opacity bg-dark bg-opacity-50 w-100 h-100">
                <i class="fas fa-arrow-right fa-3x text-white"></i>
              </div>
            </div>
            <div class="card-body flex-grow-1 d-flex align-items-center">
              <h5 class="card-title fw-semibold text-truncate mb-0" title="<%= element.categoryname %>">
                <%= element.categoryname %>
              </h5>
            </div>
          </button>
        </form>
      </div>
      <% }) %>
    </div>
  </div>
</section>


<!-- Pagination -->
<div class="container my-5">
  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center flex-wrap gap-2">
      <% for (let i = 1; i <= page; i++) { %>
      <li class="page-item <%= i === selectedpage ? 'active' : '' %>">
        <button class="page-link" onclick="loadPage('<%= i %>')"><%= i %></button>
      </li>
      <% } %>
    </ul>
  </nav>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('partials/userfooter') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
  let debounceTimer;

  function searchItem(value) {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      const currentPage = 1;
      window.location.href = `/user/home?pagenumber=${currentPage}&category=${encodeURIComponent(value)}`;
    }, 700);
  }

  function loadPage(pageNumber) {
    const searchValue = document.getElementById('searchInput')?.value || '';
    window.location.href = `/user/home?pagenumber=${pageNumber}&category=${encodeURIComponent(searchValue)}`;
  }
</script>

<% if (successmessage && successmessage.length > 0) { %>
<script>
  Swal.fire({
    text: "<%= successmessage %>",
    icon: "success",
    confirmButtonText: "OK"
  });
</script>
<% } %>
