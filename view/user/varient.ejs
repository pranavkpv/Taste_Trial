<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<%- include('partials/userheader') %>

<div style="margin-top: 5%; margin-bottom: 10%;">
  <div class="container">
  <h1 class="mb-4">Available Variants</h1>

  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/user/home" class="text-decoration-none">Home</a></li>
      <li class="breadcrumb-item"><a href="/user/product?categoryId=<%= categorys._id %>" class="text-decoration-none">Product</a></li>
      <li class="breadcrumb-item"><a href="/user/hotels?foodId=<%= foods._id %>" class="text-decoration-none">Hotel</a></li>
      <li class="breadcrumb-item active" aria-current="page">Variant</li>
    </ol>
  </nav>

  <!-- Price Filter -->
  <div class="mb-4">
    <select id="price" class="form-select form-select-lg w-auto" aria-label="Sort by price" onchange="price()" >
      <option value="" disabled selected>
        <% if (price=="lth") { %>
          Low To High
        <% } else if (price=="htl") { %>
          High To Low
        <% } else { %>
          Price
        <% } %>
      </option>
      <option value="lth">Low To High</option>
      <option value="htl">High To Low</option>
    </select>
  </div>

  <!-- Variants Grid -->
  <div class="row g-4">
    <% varients.forEach(element => { %>
    <div class="col-12 col-sm-6 col-md-4 col-lg-3">
      <form action="/user/productDetail" method="get" class="h-100 d-flex flex-column shadow-sm rounded bg-white p-3">
        <input type="hidden" name="rateid" value="<%= element._id %>">
        <input type="hidden" name="hotelid" value="<%= hotels._id %>">
        <input type="hidden" name="foodid" value="<%= foods._id %>">
        <input type="hidden" name="varientid" value="<%= element.varientDetails[0]._id %>">

        <button type="submit" class="btn btn-link p-0 text-start overflow-hidden rounded h-100 d-flex flex-column">
          <div class="ratio ratio-4x3 rounded mb-3 overflow-hidden shadow-sm">
            <img src="<%= element.images[0] %>" alt="<%= foods.foodname %>" class="object-fit-cover w-100 h-100" />
          </div>

          <div class="flex-grow-1 d-flex flex-column justify-content-between">
            <div>
              <h5 class="mb-1"><%= foods.foodname %></h5>
              <h6 class="text-muted fst-italic">(<%= element.varientDetails[0].varientname %>)</h6>
            </div>
            <div class="d-flex justify-content-between align-items-center mt-3">
              <span class="fw-bold fs-5">â‚¹<%= element.rate %></span>
              <small class="text-muted"><i class="fas fa-clock me-1"></i><%= element.delivery_time %> min</small>
            </div>
          </div>
        </button>
      </form>
    </div>
    <% }); %>
  </div>
</div>
</div>

<script>
  function price() {
    const price = document.getElementById('price').value;
    const urlParams = new URLSearchParams(window.location.search);
    const varient = urlParams.get('varient') || '';

    if (price) {
      window.location.href = `/user/varient?varient=${encodeURIComponent(varient)}&hotelId=<%= hotels?._id || '' %>&foodId=<%= foods?._id || '' %>&price=${price}`;
    }
  }
</script>

<%- include('partials/userfooter') %>
